<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Analytics Agent - API Test Frontend</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .api-status {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online { background: #4CAF50; }
        .status-offline { background: #f44336; }

        .sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 20px;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .route-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .route-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .route-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .method {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
            margin-right: 10px;
            min-width: 60px;
            text-align: center;
        }

        .method.get { background: #10b981; }
        .method.post { background: #3b82f6; }
        .method.delete { background: #ef4444; }

        .route-path {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #374151;
        }

        .route-description {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #374151;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .form-group input[type="file"] {
            padding: 6px;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #5a67d8;
        }

        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .result-area {
            margin-top: 15px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 4px;
            border-left: 4px solid #667eea;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            display: none;
        }

        .result-area.show {
            display: block;
        }

        .result-area.error {
            border-left-color: #ef4444;
            background: #fef2f2;
            color: #991b1b;
        }

        .result-area.success {
            border-left-color: #10b981;
            background: #f0fdf4;
            color: #166534;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .session-info {
            background: #e0e7ff;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .session-info strong {
            color: #3730a3;
        }

        .clear-btn {
            background: #6b7280;
            font-size: 0.8rem;
            padding: 4px 8px;
            margin-left: 10px;
        }

        .clear-btn:hover {
            background: #4b5563;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Visual Analytics Agent</h1>
            <p>Interactive API Testing Frontend - Test All 31 Endpoints</p>
        </div>

        <div class="api-status">
            <span class="status-indicator status-offline" id="statusIndicator"></span>
            <span id="statusText">Checking API status...</span>
        </div>

        <div class="session-info">
            <strong>Session ID:</strong> <span id="sessionId">Not created</span>
            <button class="btn clear-btn" onclick="createNewSession()">New Session</button>
        </div>

        <div class="sections">
            <!-- Health Routes Section -->
            <div class="section">
                <h2>üè• Health & Monitoring Routes</h2>
                
                <!-- Basic Health Check -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method get">GET</span>
                        <span class="route-path">/api/health</span>
                    </div>
                    <div class="route-description">Basic health check</div>
                    <button class="btn" onclick="callAPI('GET', '/api/health', null, 'health-basic')">
                        Check Health
                    </button>
                    <div class="result-area" id="health-basic"></div>
                </div>

                <!-- Detailed Health Check -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method get">GET</span>
                        <span class="route-path">/api/health/detailed</span>
                    </div>
                    <div class="route-description">Detailed health with system info</div>
                    <button class="btn" onclick="callAPI('GET', '/api/health/detailed', null, 'health-detailed')">
                        Detailed Health
                    </button>
                    <div class="result-area" id="health-detailed"></div>
                </div>

                <!-- Readiness Check -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method get">GET</span>
                        <span class="route-path">/api/health/readiness</span>
                    </div>
                    <div class="route-description">Kubernetes-style readiness check</div>
                    <button class="btn" onclick="callAPI('GET', '/api/health/readiness', null, 'health-readiness')">
                        Check Readiness
                    </button>
                    <div class="result-area" id="health-readiness"></div>
                </div>

                <!-- Liveness Check -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method get">GET</span>
                        <span class="route-path">/api/health/liveness</span>
                    </div>
                    <div class="route-description">Kubernetes-style liveness check</div>
                    <button class="btn" onclick="callAPI('GET', '/api/health/liveness', null, 'health-liveness')">
                        Check Liveness
                    </button>
                    <div class="result-area" id="health-liveness"></div>
                </div>

                <!-- Metrics -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method get">GET</span>
                        <span class="route-path">/api/health/metrics</span>
                    </div>
                    <div class="route-description">System metrics and performance data</div>
                    <button class="btn" onclick="callAPI('GET', '/api/health/metrics', null, 'health-metrics')">
                        Get Metrics
                    </button>
                    <div class="result-area" id="health-metrics"></div>
                </div>
            </div>

            <!-- Data Routes Section -->
            <div class="section">
                <h2>üìä Data Management Routes</h2>
                
                <!-- Upload Dataset -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method post">POST</span>
                        <span class="route-path">/api/data/upload</span>
                    </div>
                    <div class="route-description">Upload CSV, JSON, or Excel files</div>
                    <div class="form-group">
                        <label>Select File:</label>
                        <input type="file" id="uploadFile" accept=".csv,.json,.xlsx,.xls">
                    </div>
                    <button class="btn" onclick="uploadDataset()">Upload Dataset</button>
                    <div class="result-area" id="data-upload"></div>
                </div>

                <!-- List Datasets -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method get">GET</span>
                        <span class="route-path">/api/data/datasets</span>
                    </div>
                    <div class="route-description">List all available datasets</div>
                    <button class="btn" onclick="listDatasets()">List Datasets</button>
                    <div class="result-area" id="data-list"></div>
                </div>

                <!-- Dataset Details -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method get">GET</span>
                        <span class="route-path">/api/data/datasets/{id}</span>
                    </div>
                    <div class="route-description">Get detailed dataset information</div>
                    <div class="form-group">
                        <label>Dataset ID:</label>
                        <input type="text" id="datasetDetailsId" placeholder="Enter dataset ID">
                    </div>
                    <button class="btn" onclick="getDatasetDetails()">Get Details</button>
                    <div class="result-area" id="data-details"></div>
                </div>

                <!-- Dataset Preview -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method get">GET</span>
                        <span class="route-path">/api/data/datasets/{id}/preview</span>
                    </div>
                    <div class="route-description">Preview dataset rows</div>
                    <div class="form-group">
                        <label>Dataset ID:</label>
                        <input type="text" id="previewDatasetId" placeholder="Enter dataset ID">
                    </div>
                    <div class="form-group">
                        <label>Number of rows:</label>
                        <input type="number" id="previewRows" value="10" min="1" max="100">
                    </div>
                    <button class="btn" onclick="previewDataset()">Preview Dataset</button>
                    <div class="result-area" id="data-preview"></div>
                </div>

                <!-- Dataset Statistics -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method get">GET</span>
                        <span class="route-path">/api/data/datasets/{id}/stats</span>
                    </div>
                    <div class="route-description">Get dataset statistics</div>
                    <div class="form-group">
                        <label>Dataset ID:</label>
                        <input type="text" id="statsDatasetId" placeholder="Enter dataset ID">
                    </div>
                    <button class="btn" onclick="getDatasetStats()">Get Statistics</button>
                    <div class="result-area" id="data-stats"></div>
                </div>

                <!-- Delete Dataset -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method delete">DELETE</span>
                        <span class="route-path">/api/data/datasets/{id}</span>
                    </div>
                    <div class="route-description">Delete a dataset</div>
                    <div class="form-group">
                        <label>Dataset ID:</label>
                        <input type="text" id="deleteDatasetId" placeholder="Enter dataset ID">
                    </div>
                    <button class="btn" onclick="deleteDataset()">Delete Dataset</button>
                    <div class="result-area" id="data-delete"></div>
                </div>
            </div>

            <!-- Analysis Routes Section -->
            <div class="section">
                <h2>üîç Analysis & Insights Routes</h2>
                
                <!-- Analyze Dataset -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method post">POST</span>
                        <span class="route-path">/api/analysis/analyze</span>
                    </div>
                    <div class="route-description">Perform comprehensive data analysis</div>
                    <div class="form-group">
                        <label>Dataset ID:</label>
                        <input type="text" id="analyzeDatasetId" placeholder="Enter dataset ID">
                    </div>
                    <div class="form-group">
                        <label>Analysis Type:</label>
                        <select id="analysisType">
                            <option value="comprehensive">Comprehensive</option>
                            <option value="exploratory">Exploratory</option>
                            <option value="statistical">Statistical</option>
                            <option value="correlation">Correlation</option>
                            <option value="clustering">Clustering</option>
                            <option value="predictive">Predictive</option>
                        </select>
                    </div>
                    <button class="btn" onclick="analyzeDataset()">Analyze Dataset</button>
                    <div class="result-area" id="analysis-analyze"></div>
                </div>

                <!-- Natural Language Query -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method post">POST</span>
                        <span class="route-path">/api/analysis/query</span>
                    </div>
                    <div class="route-description">Ask questions about your data in natural language</div>
                    <div class="form-group">
                        <label>Dataset ID:</label>
                        <input type="text" id="queryDatasetId" placeholder="Enter dataset ID">
                    </div>
                    <div class="form-group">
                        <label>Query:</label>
                        <textarea id="queryText" rows="3" placeholder="e.g., What are the average sales by region?"></textarea>
                    </div>
                    <button class="btn" onclick="queryDataset()">Ask Question</button>
                    <div class="result-area" id="analysis-query"></div>
                </div>

                <!-- Generate Insights -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method post">POST</span>
                        <span class="route-path">/api/analysis/insights</span>
                    </div>
                    <div class="route-description">Generate automated insights</div>
                    <div class="form-group">
                        <label>Dataset ID:</label>
                        <input type="text" id="insightsDatasetId" placeholder="Enter dataset ID">
                    </div>
                    <div class="form-group">
                        <label>Insight Type:</label>
                        <select id="insightType">
                            <option value="automated">Automated</option>
                            <option value="statistical">Statistical</option>
                            <option value="patterns">Patterns</option>
                            <option value="outliers">Outliers</option>
                            <option value="trends">Trends</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Top N Insights:</label>
                        <input type="number" id="topNInsights" value="5" min="1" max="20">
                    </div>
                    <button class="btn" onclick="generateInsights()">Generate Insights</button>
                    <div class="result-area" id="analysis-insights"></div>
                </div>

                <!-- Get Analysis Results -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method get">GET</span>
                        <span class="route-path">/api/analysis/results/{id}</span>
                    </div>
                    <div class="route-description">Get previous analysis results</div>
                    <div class="form-group">
                        <label>Analysis ID:</label>
                        <input type="text" id="analysisResultId" placeholder="Enter analysis ID">
                    </div>
                    <button class="btn" onclick="getAnalysisResults()">Get Results</button>
                    <div class="result-area" id="analysis-results"></div>
                </div>

                <!-- Generate Report -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method post">POST</span>
                        <span class="route-path">/api/analysis/report</span>
                    </div>
                    <div class="route-description">Generate comprehensive analysis report</div>
                    <div class="form-group">
                        <label>Dataset ID:</label>
                        <input type="text" id="reportDatasetId" placeholder="Enter dataset ID">
                    </div>
                    <div class="form-group">
                        <label>Report Type:</label>
                        <select id="reportType">
                            <option value="comprehensive">Comprehensive</option>
                            <option value="executive">Executive Summary</option>
                            <option value="technical">Technical</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="includeViz" checked> Include Visualizations
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="includeCode" checked> Include Code
                        </label>
                    </div>
                    <button class="btn" onclick="generateReport()">Generate Report</button>
                    <div class="result-area" id="analysis-report"></div>
                </div>
            </div>

            <!-- Visualization Routes Section -->
            <div class="section">
                <h2>üìà Visualization Routes</h2>
                
                <!-- Create Visualization -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method post">POST</span>
                        <span class="route-path">/api/visualization/create</span>
                    </div>
                    <div class="route-description">Create interactive visualizations</div>
                    <div class="form-group">
                        <label>Dataset ID:</label>
                        <input type="text" id="vizDatasetId" placeholder="Enter dataset ID">
                    </div>
                    <div class="form-group">
                        <label>Chart Type:</label>
                        <select id="chartType">
                            <option value="scatter">Scatter Plot</option>
                            <option value="line">Line Chart</option>
                            <option value="bar">Bar Chart</option>
                            <option value="histogram">Histogram</option>
                            <option value="box">Box Plot</option>
                            <option value="heatmap">Heatmap</option>
                            <option value="pie">Pie Chart</option>
                            <option value="violin">Violin Plot</option>
                            <option value="area">Area Chart</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>X Column:</label>
                        <input type="text" id="xColumn" placeholder="Enter column name">
                    </div>
                    <div class="form-group">
                        <label>Y Column:</label>
                        <input type="text" id="yColumn" placeholder="Enter column name">
                    </div>
                    <div class="form-group">
                        <label>Color Column (optional):</label>
                        <input type="text" id="colorColumn" placeholder="Enter column name">
                    </div>
                    <div class="form-group">
                        <label>Title (optional):</label>
                        <input type="text" id="vizTitle" placeholder="Enter chart title">
                    </div>
                    <button class="btn" onclick="createVisualization()">Create Visualization</button>
                    <div class="result-area" id="viz-create"></div>
                </div>

                <!-- Create Chart -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method post">POST</span>
                        <span class="route-path">/api/visualization/chart</span>
                    </div>
                    <div class="route-description">Create chart with custom styling</div>
                    <div class="form-group">
                        <label>Dataset ID:</label>
                        <input type="text" id="chartDatasetId" placeholder="Enter dataset ID">
                    </div>
                    <div class="form-group">
                        <label>Chart Type:</label>
                        <select id="chartType2">
                            <option value="scatter">Scatter Plot</option>
                            <option value="line">Line Chart</option>
                            <option value="bar">Bar Chart</option>
                            <option value="histogram">Histogram</option>
                            <option value="box">Box Plot</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>X Column:</label>
                        <input type="text" id="chartXColumn" placeholder="Enter column name">
                    </div>
                    <div class="form-group">
                        <label>Y Column:</label>
                        <input type="text" id="chartYColumn" placeholder="Enter column name">
                    </div>
                    <button class="btn" onclick="createChart()">Create Chart</button>
                    <div class="result-area" id="viz-chart"></div>
                </div>

                <!-- Create Dashboard -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method post">POST</span>
                        <span class="route-path">/api/visualization/dashboard</span>
                    </div>
                    <div class="route-description">Create multi-chart dashboard</div>
                    <div class="form-group">
                        <label>Dataset ID:</label>
                        <input type="text" id="dashboardDatasetId" placeholder="Enter dataset ID">
                    </div>
                    <div class="form-group">
                        <label>Dashboard Title:</label>
                        <input type="text" id="dashboardTitle" placeholder="Enter dashboard title">
                    </div>
                    <button class="btn" onclick="createDashboard()">Create Dashboard</button>
                    <div class="result-area" id="viz-dashboard"></div>
                </div>

                <!-- Get Chart -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method get">GET</span>
                        <span class="route-path">/api/visualization/charts/{id}</span>
                    </div>
                    <div class="route-description">Get chart details</div>
                    <div class="form-group">
                        <label>Chart ID:</label>
                        <input type="text" id="getChartId" placeholder="Enter chart ID">
                    </div>
                    <button class="btn" onclick="getChart()">Get Chart</button>
                    <div class="result-area" id="viz-get-chart"></div>
                </div>

                <!-- Get Dashboard -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method get">GET</span>
                        <span class="route-path">/api/visualization/dashboards/{id}</span>
                    </div>
                    <div class="route-description">Get dashboard details</div>
                    <div class="form-group">
                        <label>Dashboard ID:</label>
                        <input type="text" id="getDashboardId" placeholder="Enter dashboard ID">
                    </div>
                    <button class="btn" onclick="getDashboard()">Get Dashboard</button>
                    <div class="result-area" id="viz-get-dashboard"></div>
                </div>

                <!-- Export Visualization -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method post">POST</span>
                        <span class="route-path">/api/visualization/export</span>
                    </div>
                    <div class="route-description">Export visualization in various formats</div>
                    <div class="form-group">
                        <label>Visualization ID:</label>
                        <input type="text" id="exportVizId" placeholder="Enter visualization ID">
                    </div>
                    <div class="form-group">
                        <label>Visualization Type:</label>
                        <select id="exportVizType">
                            <option value="chart">Chart</option>
                            <option value="dashboard">Dashboard</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Export Format:</label>
                        <select id="exportFormat">
                            <option value="html">HTML</option>
                            <option value="json">JSON</option>
                            <option value="png">PNG</option>
                            <option value="pdf">PDF</option>
                        </select>
                    </div>
                    <button class="btn" onclick="exportVisualization()">Export</button>
                    <div class="result-area" id="viz-export"></div>
                </div>

                <!-- Get Visualization Suggestions -->
                <div class="route-card">
                    <div class="route-header">
                        <span class="method get">GET</span>
                        <span class="route-path">/api/visualization/suggest</span>
                    </div>
                    <div class="route-description">Get AI-powered visualization suggestions</div>
                    <div class="form-group">
                        <label>Dataset ID:</label>
                        <input type="text" id="suggestDatasetId" placeholder="Enter dataset ID">
                    </div>
                    <button class="btn" onclick="getVisualizationSuggestions()">Get Suggestions</button>
                    <div class="result-area" id="viz-suggest"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api';
        let currentSessionId = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkAPIStatus();
            createNewSession();
        });

        // Check API status
        async function checkAPIStatus() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                if (response.ok) {
                    document.getElementById('statusIndicator').className = 'status-indicator status-online';
                    document.getElementById('statusText').textContent = 'API is online and healthy';
                } else {
                    throw new Error('API not responding');
                }
            } catch (error) {
                document.getElementById('statusIndicator').className = 'status-indicator status-offline';
                document.getElementById('statusText').textContent = 'API is offline or unreachable';
            }
        }

        // Create new session
        function createNewSession() {
            currentSessionId = 'session_' + Date.now();
            document.getElementById('sessionId').textContent = currentSessionId;
        }

        // Generic API call function
        async function callAPI(method, endpoint, body, resultElementId) {
            const resultElement = document.getElementById(resultElementId);
            const button = event.target;
            
            try {
                // Show loading state
                button.disabled = true;
                button.textContent = 'Loading...';
                resultElement.className = 'result-area show';
                resultElement.textContent = 'Making API request...';

                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };

                if (body) {
                    options.body = JSON.stringify(body);
                }

                const response = await fetch(`${API_BASE}${endpoint}`, options);
                const data = await response.json();

                if (response.ok) {
                    resultElement.className = 'result-area show success';
                    resultElement.textContent = JSON.stringify(data, null, 2);
                } else {
                    resultElement.className = 'result-area show error';
                    resultElement.textContent = `Error ${response.status}: ${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultElement.className = 'result-area show error';
                resultElement.textContent = `Network Error: ${error.message}`;
            } finally {
                // Reset button
                button.disabled = false;
                button.textContent = button.getAttribute('data-original-text') || 'Submit';
            }
        }

        // Store original button text on page load
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.btn').forEach(btn => {
                btn.setAttribute('data-original-text', btn.textContent);
            });
        });

        // Data Routes Functions
        async function uploadDataset() {
            const fileInput = document.getElementById('uploadFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file first');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            if (currentSessionId) {
                formData.append('session_id', currentSessionId);
            }

            const resultElement = document.getElementById('data-upload');
            const button = event.target;

            try {
                button.disabled = true;
                button.textContent = 'Uploading...';
                resultElement.className = 'result-area show';
                resultElement.textContent = 'Uploading file...';

                const response = await fetch(`${API_BASE}/data/upload`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    resultElement.className = 'result-area show success';
                    resultElement.textContent = JSON.stringify(data, null, 2);
                } else {
                    resultElement.className = 'result-area show error';
                    resultElement.textContent = `Error ${response.status}: ${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultElement.className = 'result-area show error';
                resultElement.textContent = `Network Error: ${error.message}`;
            } finally {
                button.disabled = false;
                button.textContent = 'Upload Dataset';
            }
        }

        function listDatasets() {
            let endpoint = '/data/datasets';
            if (currentSessionId) {
                endpoint += `?session_id=${currentSessionId}`;
            }
            callAPI('GET', endpoint, null, 'data-list');
        }

        function getDatasetDetails() {
            const datasetId = document.getElementById('datasetDetailsId').value;
            if (!datasetId) {
                alert('Please enter a dataset ID');
                return;
            }
            callAPI('GET', `/data/datasets/${datasetId}`, null, 'data-details');
        }

        function previewDataset() {
            const datasetId = document.getElementById('previewDatasetId').value;
            const rows = document.getElementById('previewRows').value;
            if (!datasetId) {
                alert('Please enter a dataset ID');
                return;
            }
            callAPI('GET', `/data/datasets/${datasetId}/preview?rows=${rows}`, null, 'data-preview');
        }

        function getDatasetStats() {
            const datasetId = document.getElementById('statsDatasetId').value;
            if (!datasetId) {
                alert('Please enter a dataset ID');
                return;
            }
            callAPI('GET', `/data/datasets/${datasetId}/stats`, null, 'data-stats');
        }

        function deleteDataset() {
            const datasetId = document.getElementById('deleteDatasetId').value;
            if (!datasetId) {
                alert('Please enter a dataset ID');
                return;
            }
            if (!confirm('Are you sure you want to delete this dataset?')) {
                return;
            }
            let endpoint = `/data/datasets/${datasetId}`;
            if (currentSessionId) {
                endpoint += `?session_id=${currentSessionId}`;
            }
            callAPI('DELETE', endpoint, null, 'data-delete');
        }

        // Analysis Routes Functions
        function analyzeDataset() {
            const datasetId = document.getElementById('analyzeDatasetId').value;
            const analysisType = document.getElementById('analysisType').value;
            
            if (!datasetId) {
                alert('Please enter a dataset ID');
                return;
            }

            const body = {
                dataset_id: datasetId,
                session_id: currentSessionId,
                analysis_type: analysisType,
                parameters: {}
            };

            callAPI('POST', '/analysis/analyze', body, 'analysis-analyze');
        }

        function queryDataset() {
            const datasetId = document.getElementById('queryDatasetId').value;
            const query = document.getElementById('queryText').value;
            
            if (!datasetId || !query) {
                alert('Please enter both dataset ID and query');
                return;
            }

            const body = {
                dataset_id: datasetId,
                session_id: currentSessionId,
                query: query
            };

            callAPI('POST', '/analysis/query', body, 'analysis-query');
        }

        function generateInsights() {
            const datasetId = document.getElementById('insightsDatasetId').value;
            const insightType = document.getElementById('insightType').value;
            const topN = document.getElementById('topNInsights').value;
            
            if (!datasetId) {
                alert('Please enter a dataset ID');
                return;
            }

            const body = {
                dataset_id: datasetId,
                session_id: currentSessionId,
                insight_type: insightType,
                top_n: parseInt(topN)
            };

            callAPI('POST', '/analysis/insights', body, 'analysis-insights');
        }

        function getAnalysisResults() {
            const analysisId = document.getElementById('analysisResultId').value;
            if (!analysisId) {
                alert('Please enter an analysis ID');
                return;
            }
            callAPI('GET', `/analysis/results/${analysisId}?session_id=${currentSessionId}`, null, 'analysis-results');
        }

        function generateReport() {
            const datasetId = document.getElementById('reportDatasetId').value;
            const reportType = document.getElementById('reportType').value;
            const includeViz = document.getElementById('includeViz').checked;
            const includeCode = document.getElementById('includeCode').checked;
            
            if (!datasetId) {
                alert('Please enter a dataset ID');
                return;
            }

            const body = {
                dataset_id: datasetId,
                session_id: currentSessionId,
                report_type: reportType,
                include_visualizations: includeViz,
                include_code: includeCode
            };

            callAPI('POST', '/analysis/report', body, 'analysis-report');
        }

        // Visualization Routes Functions
        function createVisualization() {
            const datasetId = document.getElementById('vizDatasetId').value;
            const chartType = document.getElementById('chartType').value;
            const xColumn = document.getElementById('xColumn').value;
            const yColumn = document.getElementById('yColumn').value;
            const colorColumn = document.getElementById('colorColumn').value;
            const title = document.getElementById('vizTitle').value;
            
            if (!datasetId || !chartType) {
                alert('Please enter dataset ID and select chart type');
                return;
            }

            const body = {
                dataset_id: datasetId,
                session_id: currentSessionId,
                chart_type: chartType,
                x_column: xColumn || null,
                y_column: yColumn || null,
                color_column: colorColumn || null,
                title: title || null,
                chart_parameters: {}
            };

            callAPI('POST', '/visualization/create', body, 'viz-create');
        }

        function createChart() {
            const datasetId = document.getElementById('chartDatasetId').value;
            const chartType = document.getElementById('chartType2').value;
            const xColumn = document.getElementById('chartXColumn').value;
            const yColumn = document.getElementById('chartYColumn').value;
            
            if (!datasetId || !chartType) {
                alert('Please enter dataset ID and select chart type');
                return;
            }

            const body = {
                dataset_id: datasetId,
                session_id: currentSessionId,
                chart_type: chartType,
                x_column: xColumn || null,
                y_column: yColumn || null,
                styling_options: {}
            };

            callAPI('POST', '/visualization/chart', body, 'viz-chart');
        }

        function createDashboard() {
            const datasetId = document.getElementById('dashboardDatasetId').value;
            const title = document.getElementById('dashboardTitle').value;
            
            if (!datasetId) {
                alert('Please enter a dataset ID');
                return;
            }

            const body = {
                dataset_id: datasetId,
                session_id: currentSessionId,
                title: title || 'Dashboard',
                charts: [
                    {
                        chart_type: 'bar',
                        title: 'Sample Bar Chart'
                    },
                    {
                        chart_type: 'line',
                        title: 'Sample Line Chart'
                    }
                ],
                layout: {}
            };

            callAPI('POST', '/visualization/dashboard', body, 'viz-dashboard');
        }

        function getChart() {
            const chartId = document.getElementById('getChartId').value;
            if (!chartId) {
                alert('Please enter a chart ID');
                return;
            }
            callAPI('GET', `/visualization/charts/${chartId}?session_id=${currentSessionId}`, null, 'viz-get-chart');
        }

        function getDashboard() {
            const dashboardId = document.getElementById('getDashboardId').value;
            if (!dashboardId) {
                alert('Please enter a dashboard ID');
                return;
            }
            callAPI('GET', `/visualization/dashboards/${dashboardId}?session_id=${currentSessionId}`, null, 'viz-get-dashboard');
        }

        function exportVisualization() {
            const vizId = document.getElementById('exportVizId').value;
            const vizType = document.getElementById('exportVizType').value;
            const format = document.getElementById('exportFormat').value;
            
            if (!vizId) {
                alert('Please enter a visualization ID');
                return;
            }

            const body = {
                visualization_id: vizId,
                session_id: currentSessionId,
                visualization_type: vizType,
                format: format
            };

            callAPI('POST', '/visualization/export', body, 'viz-export');
        }

        function getVisualizationSuggestions() {
            const datasetId = document.getElementById('suggestDatasetId').value;
            if (!datasetId) {
                alert('Please enter a dataset ID');
                return;
            }
            callAPI('GET', `/visualization/suggest?dataset_id=${datasetId}`, null, 'viz-suggest');
        }
    </script>
</body>
</html> 